<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Add an icon to the map</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link href="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.css" rel="stylesheet" />
    <link href="style.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v1.8.1/mapbox-gl.js"></script>
    <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
    <style>

    </style>
</head>
<body onload="init();">
<div id="map"></div>

<canvas id="gameCanvas">
    alternate content
</canvas>

<script>

    var stage, isRunning;
    isRunning = false;

    function init() {
        stage = new createjs.Stage("gameCanvas");

        /*circle = new createjs.Shape();
        circle.graphics.beginFill("red").drawCircle(0, 0, 40);
        circle.y = 50;
        stage.addChild(circle);*/

        var data = {
            images: ["./../sprites/spritesheet_grant.png"],
            frames: {width:165, height:292},
            animations: {
                idle:0,
                "run": [0, 25, "run", 1.5],
                "jump": [26, 63, "run"]
            },
            framerate: 30
        };
        var spriteSheet = new createjs.SpriteSheet(data);
        var sprite = new createjs.Sprite(spriteSheet, "idle");
        sprite.name = "player";
        stage.addChild(sprite);

        createjs.Ticker.on("tick", tick);
    }

    function tick(event) {
        stage.getChildByName("player").setTransform(130, 30, 0.2, 0.2);
        if (isRunning) {
            if (stage.getChildByName("player").currentAnimation !== "run")
                stage.getChildByName("player").gotoAndPlay("run");
        }
        else{
            if (stage.getChildByName("player").currentAnimation !== "idle")
                stage.getChildByName("player").gotoAndPlay("idle");
        }

        stage.update(event); // important!!
    }

    mapboxgl.accessToken = 'pk.eyJ1IjoiZmlyc3RzdGVmIiwiYSI6ImNrNzRneHkzbTBpaDQzZnBkZDY3dXRjaDQifQ.g6l-GFeBB2cUisg6MqweaA';
    let map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-77.04, 38.907],
        zoom: 30
    });

    var mySource;

    map.on('load', function() {
        map.loadImage(
            'https://upload.wikimedia.org/wikipedia/commons/thumb/6/60/Cat_silhouette.svg/400px-Cat_silhouette.svg.png',
            function(error, image) {
                if (error) throw error;
                map.addImage('cat', image);
                map.addSource('point', {
                    'type': 'geojson',
                    'data': {
                        'type': 'FeatureCollection',
                        'features': [
                            {
                                'type': 'Feature',
                                'geometry': {
                                    'type': 'Point',
                                    'coordinates': [0, 0]
                                }
                            }
                        ]
                    }
                });
                map.addLayer({
                    'id': 'points',
                    'type': 'symbol',
                    'source': 'point',
                    'layout': {
                        'icon-image': 'cat',
                        'icon-size': 0.25
                    }
                });
            }
        );

        // pixels the map pans when the up or down arrow is clicked
        const deltaDistance = 1000;

        // degrees the map rotates when the left or right arrow is clicked
        const deltaDegrees = 25;

        function easing(t) {
            return t * (2 - t);
        }

        map.getCanvas().focus();

        map.getCanvas().addEventListener(
            'keydown',
            function(e) {
                e.preventDefault();
                isRunning = true;
                if (e.which === 38) {
                // up
                    map.panBy([0, -deltaDistance], {
                        easing: easing
                    });
                } else if (e.which === 40) {
                // down
                    map.panBy([0, deltaDistance], {
                        easing: easing
                    });
                } else if (e.which === 37) {
                // left
                    map.easeTo({
                        bearing: map.getBearing() - deltaDegrees,
                        easing: easing
                    });
                } else if (e.which === 39) {
                // right
                    map.easeTo({
                        bearing: map.getBearing() + deltaDegrees,
                        easing: easing
                    });
                }
            },
            true
        );
    });

    /*
    const someBounds = [[32.958984, -5.353521], [43.50585, 5.615985]];

    map.fitBounds(
        someBounds, // arbitrary bounds
        {
            linear: true
        });

    setInterval( function(){
        var features = map.queryRenderedFeatures(
            {layers: ["building"], filter: ['==', 'extrude', 'true']}); // This is where I get building information

        features.forEach(function(feature){
            console.log(feature.geometry);  // feature.geometry getter returns building shape points (basement)
            console.log(feature.properties.height); // this is the building height
            console.log(feature.properties.min_height); // this is the building part elevation from groung (e.g. a bridge)
        });
    }, 10000);
    */


</script>

</body>
</html>